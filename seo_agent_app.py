import streamlit as st
from openai import OpenAI

# –ù–û–í–ò–ô –¥–µ—Ç–∞–ª—å–Ω–∏–π –ø—Ä–æ–º–ø—Ç
SEO_PROMPT_TEMPLATE = """–¢–∏ ‚Äî –®–Ü-–∞–≥–µ–Ω—Ç, —è–∫–∏–π —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –Ω–∞ SEO-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É. –¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –æ–ø–∏—Å –≤—ñ–¥–µ–æ –≤ —è–∫—ñ—Å–Ω–∏–π, –∑—Ä–æ–∑—É–º—ñ–ª–∏–π —Ç–∞ –¥–æ–±—Ä–µ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è –ø–æ—à—É–∫–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º —Ç–µ–∫—Å—Ç. –í–∏–∫–æ–Ω—É–π –∑–∞–≤–¥–∞–Ω–Ω—è, –¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π:

1.  **–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤:** –í–∏–∑–Ω–∞—á –≥–æ–ª–æ–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ —Ç–∞ —Ñ—Ä–∞–∑–∏, —è–∫—ñ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ç–µ–º–∞—Ç–∏—Ü—ñ –≤—ñ–¥–µ–æ.
2.  **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –ø—Ä–∏—Ä–æ–¥–Ω–æ —ñ –ª–æ–≥—ñ—á–Ω–æ –ø–æ –≤—Å—å–æ–º—É —Ç–µ–∫—Å—Ç—É, —É–Ω–∏–∫–∞—é—á–∏ –ø–µ—Ä–µ–Ω–∞—Å–∏—á–µ–Ω–Ω—è (keyword stuffing).
3.  **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–∫—Å—Ç—É:**
    * –†–æ–∑–±–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —á—ñ—Ç–∫—ñ, –ª–æ–≥—ñ—á–Ω—ñ –∞–±–∑–∞—Ü–∏.
    * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, H2, H3) –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞–Ω–Ω—è.
    * –°—Ç–≤–æ—Ä–∏ —Ç–µ–∫—Å—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ: –∫–æ—Ä–æ—Ç–∫–∏–π –≤—Å—Ç—É–ø, —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∞ –æ—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞, –≤–∏—Å–Ω–æ–≤–æ–∫.
    * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –º–∞—Ä–∫–æ–≤–∞–Ω—ñ —Ç–∞ –Ω—É–º–µ—Ä–æ–≤–∞–Ω—ñ —Å–ø–∏—Å–∫–∏, —è–∫—â–æ —Ü–µ –¥–æ—Ä–µ—á–Ω–æ –¥–ª—è –ø–æ–ª–µ–≥—à–µ–Ω–Ω—è —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.
4.  **–û–±—Å—è–≥ —Ç–µ–∫—Å—Ç—É:** –î–æ—Ç—Ä–∏–º—É–π—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ–≥–æ –æ–±—Å—è–≥—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ SEO-—Ç–µ–∫—Å—Ç—É –≤ –º–µ–∂–∞—Ö 200‚Äì400 —Å–ª—ñ–≤.
5.  **–ú–µ—Ç–∞-—Ç–µ–≥–∏:**
    * –ó–≥–µ–Ω–µ—Ä—É–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π, –ø—Ä–∏–≤–∞–±–ª–∏–≤–∏–π **–ú–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫** (–¥–æ 60 —Å–∏–º–≤–æ–ª—ñ–≤). –í—ñ–Ω –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞.
    * –ó–≥–µ–Ω–µ—Ä—É–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–π **–ú–µ—Ç–∞-–æ–ø–∏—Å** (–¥–æ 160 —Å–∏–º–≤–æ–ª—ñ–≤). –í—ñ–Ω —Ç–∞–∫–æ–∂ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ —Ç–∞ —Å–ø–æ–Ω—É–∫–∞—Ç–∏ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É.
6.  **–§–æ—Ä–º–∞—Ç –≤–∏–≤–µ–¥–µ–Ω–Ω—è:** –ù–∞–¥–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å —á—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª—è—é—á–∏ –æ—Å–Ω–æ–≤–Ω–∏–π SEO-—Ç–µ–∫—Å—Ç, –ú–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ –ú–µ—Ç–∞-–æ–ø–∏—Å. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

    **–ú–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫:**
    [–¢—É—Ç –º–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫]

    **–ú–µ—Ç–∞-–æ–ø–∏—Å:**
    [–¢—É—Ç –º–µ—Ç–∞-–æ–ø–∏—Å]

    **SEO-–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç:**
    [–¢—É—Ç –æ—Å–Ω–æ–≤–Ω–∏–π SEO-—Ç–µ–∫—Å—Ç –∑–≥—ñ–¥–Ω–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π]

–û—Å—å –æ–ø–∏—Å –≤—ñ–¥–µ–æ –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è:
{video_description_placeholder}

–°—Ç–≤–æ—Ä–∏ SEO-–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç, –ú–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ –ú–µ—Ç–∞-–æ–ø–∏—Å, —Å—É–≤–æ—Ä–æ –¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å –≤–∫–∞–∑–∞–Ω–∏—Ö –≤–∏–º–æ–≥.
"""

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è OpenAI –∫–ª—ñ—î–Ω—Ç–∞
try:
    client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])
except Exception as e: # –ë—ñ–ª—å—à –∑–∞–≥–∞–ª—å–Ω–∏–π –≤–∏–Ω—è—Ç–æ–∫, –æ—Å–∫—ñ–ª—å–∫–∏ st.secrets –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø–æ–º–∏–ª–∫–∏
    st.error(f"–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è OpenAI API –∫–ª—é—á–∞: {e}. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ —Ñ–∞–π–ª .streamlit/secrets.toml —ñ—Å–Ω—É—î —Ç–∞ –º—ñ—Å—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫–ª—é—á OPENAI_API_KEY.")
    st.stop() # –ó—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —è–∫—â–æ –∫–ª—é—á –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ

def generate_seo_text(original_description: str) -> str:
    """
    –ì–µ–Ω–µ—Ä—É—î SEO-–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç, –º–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ –º–µ—Ç–∞-–æ–ø–∏—Å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é OpenAI API.
    """
    if not original_description.strip():
        return "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –≤—ñ–¥–µ–æ."

    full_prompt = SEO_PROMPT_TEMPLATE.replace("{video_description_placeholder}", original_description)

    try:
        response = client.chat.completions.create(
            model="gpt-3.5-turbo", # –ê–±–æ —ñ–Ω—à—É –º–æ–¥–µ–ª—å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, gpt-4o-mini –∞–±–æ gpt-4o, —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∞ —ñ –±–∞–∂–∞–Ω–∞
            messages=[
                {"role": "system", "content": "–¢–∏ ‚Äî –®–Ü-–∞–≥–µ–Ω—Ç, —è–∫–∏–π —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –Ω–∞ SEO-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É."},
                {"role": "user", "content": full_prompt}
            ],
            temperature=0.7, # –ú–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –¥–ª—è –±—ñ–ª—å—à–æ—ó/–º–µ–Ω—à–æ—ó –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—ñ
            max_tokens=2000  # –ó–±—ñ–ª—å—à–∏–≤ max_tokens, —â–æ–± –≤–º—ñ—Å—Ç–∏—Ç–∏ —Ç–µ–∫—Å—Ç + –º–µ—Ç–∞–¥–∞–Ω—ñ
        )
        return response.choices[0].message.content.strip()
    except Exception as e:
        return f"–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ OpenAI API: {e}"

# Streamlit UI
st.set_page_config(page_title="Army TV –û–ø—Ç–∏–º—ñ–∑–∞—Ç–æ—Ä –¢–µ–∫—Å—Ç—É", layout="wide")

st.title("ü§ñ ArmyTV. –õ–µ–π—Ç–µ–Ω–∞–Ω—Ç –®–Ü –æ–ø—Ç–∏–º—ñ–∑—É—î –¥–ª—è —Ç–µ–±–µ")
st.markdown("""
–Ø –¥–æ–ø–æ–º–æ–∂—É —Ç–æ–±—ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –∑–≤–∏—á–∞–π–Ω–∏–π –æ–ø–∏—Å –Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–π —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç, —è–∫–∏–π –±—É–¥–µ –∫—Ä–∞—â–µ
—ñ–Ω–¥–µ–∫—Å—É–≤–∞—Ç–∏—Å—è –ø–æ—à—É–∫–æ–≤–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏. –Ø —Ç–∞–∫–æ–∂ –∑–≥–µ–Ω–µ—Ä—É—é –º–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ –º–µ—Ç–∞-–æ–ø–∏—Å.
""")

st.header("üìù –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ")
original_text = st.text_area("–í—Å—Ç–∞–≤—Ç–µ —Å—é–¥–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –≤–∞—à–æ–≥–æ –≤—ñ–¥–µ–æ:", height=200, key="original_text_input")

if 'seo_text' not in st.session_state:
    st.session_state.seo_text = ""

if st.button("üöÄ –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç!", type="primary", use_container_width=True):
    if original_text:
        with st.spinner("‚ú® –ú–∞–≥—ñ—è ArmyTV... –õ–µ–π—Ç–µ–Ω–∞–Ω—Ç –®–Ü –ø—Ä–∞—Ü—é—î –Ω–∞–¥ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—î—é. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞—á–µ–∫–∞–π—Ç–µ."):
            st.session_state.seo_text = generate_seo_text(original_text)
    else:
        st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó.")

if st.session_state.seo_text:
    st.header("üí° –õ–µ–π—Ç–µ–Ω–∞–Ω—Ç –®–Ü –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞–≤ —Ç–µ–∫—Å—Ç (—Ç–∞ –¥–æ–¥–∞–≤ –º–µ—Ç–∞-—Ç–µ–≥–∏)")
    st.text_area("–†–µ–∑—É–ª—å—Ç–∞—Ç (–≤–∫–ª—é—á–Ω–æ –∑ –º–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–∫–æ–º —Ç–∞ –º–µ—Ç–∞-–æ–ø–∏—Å–æ–º):", value=st.session_state.seo_text, height=600, key="seo_text_output", help="–í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ü–µ–π —Ç–µ–∫—Å—Ç. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ú–µ—Ç–∞-–∑–∞–≥–æ–ª–æ–≤–∫—É —Ç–∞ –ú–µ—Ç–∞-–æ–ø–∏—Å—É –Ω–∞ –ø–æ—á–∞—Ç–∫—É.")
    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è (–ø–æ—Ç—Ä–µ–±—É—î –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è streamlit-extras, –∞–±–æ –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏—Å—å –±–µ–∑ –Ω–µ—ó)
    # from streamlit_extras.keyboard_text import key_to_text # –ü–æ—Ç—Ä–µ–±—É—î pip install streamlit-extras
    # st.code(st.session_state.seo_text) # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–ø–æ—Å—ñ–± –ø–æ–∫–∞–∑–∞—Ç–∏ –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
    # if st.button("–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç"):
    #     st.components.v1.html(f"<script>navigator.clipboard.writeText({json.dumps(st.session_state.seo_text)});</script><div>–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</div>", height=50)

st.markdown("""
---
*–ü–æ–±—É–¥–æ–≤–∞–Ω–æ –∑ ‚ù§Ô∏è –¥–ª—è ArmyTV.*
""")